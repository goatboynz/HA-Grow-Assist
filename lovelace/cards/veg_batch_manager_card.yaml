# =============================================================================
# VEG BATCH MANAGER CARD - Simple Version
# =============================================================================
# Manage veg batches using quick buttons - no helpers needed!
#
# For custom batches, use Developer Tools > Services:
#   service: grow_room_manager.add_veg_batch
#   data:
#     room_id: veg
#     batch_name: "My Batch Name"
#     start_date: "2024-12-01"
#     stage: Clone
#     plant_count: 24
#     strain: "OG Kush"
#     destination_room: f1
#
# =============================================================================

type: vertical-stack
cards:
  - type: custom:mushroom-title-card
    title: "ðŸŒ± Veg Batch Manager"
    subtitle: "Track clones, veg plants, and mothers"

  # Current status
  - type: entities
    title: "ðŸ“Š Current Status"
    entities:
      - entity: sensor.veg_room_status
        name: "Room Status"
      - entity: sensor.veg_room_active_batches
        name: "Active Batches"
      - entity: sensor.veg_room_next_task
        name: "Next Task"

  # Batches by stage
  - type: markdown
    content: >-
      ### ðŸ“¦ Batches by Stage
      
      {% set batches = state_attr('sensor.veg_room_status', 'batches_by_stage') %}
      {% if batches and batches | length > 0 %}
      | Stage | Batches | Plants |
      |-------|---------|--------|
      {% for stage, data in batches.items() %}
      | {{ stage }} | {{ data.count }} | {{ data.plants }} |
      {% endfor %}
      
      **Total Plants:** {{ state_attr('sensor.veg_room_status', 'total_plants') }}
      {% else %}
      No active batches. Add one below!
      {% endif %}

  # Quick add section
  - type: custom:mushroom-title-card
    title: ""
    subtitle: "âš¡ Quick Add Batch"

  - type: horizontal-stack
    cards:
      - type: button
        name: "ðŸŒ± 24 Clones"
        icon: mdi:sprout
        tap_action:
          action: call-service
          service: grow_room_manager.add_veg_batch
          data:
            room_id: veg
            batch_name: "Clones {{ now().strftime('%b %d') }}"
            start_date: "{{ now().strftime('%Y-%m-%d') }}"
            stage: Clone
            plant_count: 24
            destination_room: f1
      - type: button
        name: "ðŸŒ± 12 Clones"
        icon: mdi:sprout-outline
        tap_action:
          action: call-service
          service: grow_room_manager.add_veg_batch
          data:
            room_id: veg
            batch_name: "Clones {{ now().strftime('%b %d') }}"
            start_date: "{{ now().strftime('%Y-%m-%d') }}"
            stage: Clone
            plant_count: 12
            destination_room: f1
      - type: button
        name: "ðŸ‘‘ Mother"
        icon: mdi:crown
        tap_action:
          action: call-service
          service: grow_room_manager.add_veg_batch
          data:
            room_id: veg
            batch_name: "Mother {{ now().strftime('%b %d') }}"
            start_date: "{{ now().strftime('%Y-%m-%d') }}"
            stage: Mother
            plant_count: 1
            destination_room: none

  - type: horizontal-stack
    cards:
      - type: button
        name: "ðŸŒ¿ Veg Plants (F1)"
        icon: mdi:leaf
        tap_action:
          action: call-service
          service: grow_room_manager.add_veg_batch
          data:
            room_id: veg
            batch_name: "Veg {{ now().strftime('%b %d') }}"
            start_date: "{{ now().strftime('%Y-%m-%d') }}"
            stage: Early Veg
            plant_count: 24
            destination_room: f1
      - type: button
        name: "ðŸŒ¿ Veg Plants (F2)"
        icon: mdi:leaf
        tap_action:
          action: call-service
          service: grow_room_manager.add_veg_batch
          data:
            room_id: veg
            batch_name: "Veg {{ now().strftime('%b %d') }}"
            start_date: "{{ now().strftime('%Y-%m-%d') }}"
            stage: Early Veg
            plant_count: 24
            destination_room: f2
      - type: button
        name: "ðŸŒ¿ Veg Plants (F3)"
        icon: mdi:leaf
        tap_action:
          action: call-service
          service: grow_room_manager.add_veg_batch
          data:
            room_id: veg
            batch_name: "Veg {{ now().strftime('%b %d') }}"
            start_date: "{{ now().strftime('%Y-%m-%d') }}"
            stage: Early Veg
            plant_count: 24
            destination_room: f3

  # Active batch details
  - type: markdown
    content: >-
      ---
      ### ðŸ“‹ Active Batches
      
      {% set batches = state_attr('sensor.veg_room_active_batches', 'batches') %}
      {% if batches and batches | length > 0 %}
      {% for b in batches %}
      **{{ b.name }}** `{{ b.stage }}`
      - ðŸŒ± {{ b.plants }} plants | ðŸ§¬ {{ b.strain or 'Unknown' }}
      - ðŸ“… Started: {{ b.start_date }} | ðŸŽ¯ Dest: {{ b.destination or 'TBD' }}
      - ðŸ”‘ ID: `{{ b.batch_id }}`
      
      {% endfor %}
      {% else %}
      No active batches yet.
      {% endif %}

  # Environmental targets
  - type: markdown
    content: |
      ---
      ### ðŸŒ¡ï¸ Veg Environment Targets
      
      | Parameter | Target |
      |-----------|--------|
      | Day Temp | 75-82Â°F (24-28Â°C) |
      | Night Temp | 68-75Â°F (20-24Â°C) |
      | Humidity | 55-70% RH |
      | VPD | 0.8-1.2 kPa |
      | pH | 5.8-6.2 |
      | EC | {{ state_attr('sensor.veg_room_status', 'recommended_ec') or '1.0-2.2' }} |

  # Instructions
  - type: markdown
    content: |
      ---
      ### ðŸ“ Managing Batches
      
      **Update Stage** (Developer Tools > Services):
      ```yaml
      service: grow_room_manager.update_veg_batch
      data:
        room_id: veg
        batch_id: [from batch details above]
        stage: Pre-Veg
      ```
      
      **Move to Flower**:
      ```yaml
      service: grow_room_manager.move_to_flower
      data:
        room_id: veg
        batch_id: [batch_id]
        flower_room_id: f1
      ```
