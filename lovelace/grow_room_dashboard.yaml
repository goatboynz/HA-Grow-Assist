# =============================================================================
# GROW ROOM MANAGER - Complete Dashboard
# =============================================================================
#
# HOW TO INSTALL:
# 1. Go to Settings > Dashboards > Add Dashboard
# 2. Name it "Grow Rooms" 
# 3. Open the new dashboard, click Edit (pencil icon)
# 4. Click the 3 dots menu > Raw configuration editor
# 5. Delete everything and paste this entire file
# 6. Save
#
# =============================================================================

title: Grow Room Manager
views:
  # ===========================================================================
  # HOME - Overview of all rooms
  # ===========================================================================
  - title: Home
    path: home
    icon: mdi:home
    cards:
      - type: markdown
        content: |
          # üåø Grow Room Manager
          
          Welcome! Use the tabs above to view each room or access settings.

      # All Rooms Status
      - type: horizontal-stack
        cards:
          - type: vertical-stack
            cards:
              - type: markdown
                content: "## F1"
              - type: entity
                entity: sensor.flower_room_1_grow_status
                name: Status
              - type: gauge
                entity: sensor.flower_room_1_grow_progress
                name: Progress
                min: 0
                max: 100
                severity:
                  green: 80
                  yellow: 40
                  red: 0
          - type: vertical-stack
            cards:
              - type: markdown
                content: "## F2"
              - type: entity
                entity: sensor.flower_room_2_grow_status
                name: Status
              - type: gauge
                entity: sensor.flower_room_2_grow_progress
                name: Progress
                min: 0
                max: 100
          - type: vertical-stack
            cards:
              - type: markdown
                content: "## F3"
              - type: entity
                entity: sensor.flower_room_3_grow_status
                name: Status
              - type: gauge
                entity: sensor.flower_room_3_grow_progress
                name: Progress
                min: 0
                max: 100

      # Upcoming Tasks
      - type: entities
        title: "üìã Upcoming Tasks"
        show_header_toggle: false
        entities:
          - entity: sensor.flower_room_1_next_task
            name: F1
            icon: mdi:numeric-1-circle
          - entity: sensor.flower_room_2_next_task
            name: F2
            icon: mdi:numeric-2-circle
          - entity: sensor.flower_room_3_next_task
            name: F3
            icon: mdi:numeric-3-circle

      # Quick Reference
      - type: markdown
        title: "üìä Phase Targets"
        content: |
          | Phase | Days | EC | Dryback |
          |-------|------|-----|---------|
          | Stretch | 1-21 | 3.0 | 20-25% |
          | Bulk | 22-55 | 3.0 | 30-40% |
          | Finish | 56-84 | 1.5 | 40-50% |

  # ===========================================================================
  # ROOM F1
  # ===========================================================================
  - title: F1
    path: f1
    icon: mdi:numeric-1-circle
    cards:
      # Header with status
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              # üåø Flower Room 1
              {% set s = 'sensor.flower_room_1_grow_status' %}
              {% set status = states(s) %}
              {% set phase = state_attr(s, 'phase') %}
              {% set week = state_attr(s, 'current_week') %}
              {% set harvest = state_attr(s, 'harvest_window') %}
              
              {% if status != 'Not Started' and status != 'unknown' %}
              ## {{ status }} | Week {{ week }} | {{ phase }} Phase
              {% if harvest %}
              ### üéâ HARVEST WINDOW OPEN! üéâ
              {% endif %}
              {% else %}
              ## ‚è≥ Not Started
              Go to **Settings** tab to configure start date.
              {% endif %}

          - type: gauge
            entity: sensor.flower_room_1_grow_progress
            name: Cycle Progress
            min: 0
            max: 100
            severity:
              green: 80
              yellow: 40
              red: 0

      # Current Targets
      - type: entities
        title: "üéØ Current Targets"
        show_header_toggle: false
        entities:
          - type: attribute
            entity: sensor.flower_room_1_grow_status
            attribute: recommended_ec
            name: Target EC
            icon: mdi:water
          - type: attribute
            entity: sensor.flower_room_1_grow_status
            attribute: target_dryback
            name: Target Dryback
            icon: mdi:water-percent
          - type: attribute
            entity: sensor.flower_room_1_grow_status
            attribute: days_remaining
            name: Days to Harvest
            icon: mdi:calendar-clock

      # Environmental Targets
      - type: entities
        title: "üå°Ô∏è Environmental Targets"
        show_header_toggle: false
        entities:
          - type: attribute
            entity: sensor.flower_room_1_grow_status
            attribute: target_temp_day
            name: Day Temperature
            icon: mdi:thermometer
          - type: attribute
            entity: sensor.flower_room_1_grow_status
            attribute: target_temp_night
            name: Night Temperature
            icon: mdi:thermometer-low
          - type: attribute
            entity: sensor.flower_room_1_grow_status
            attribute: target_humidity
            name: Humidity
            icon: mdi:water-outline
          - type: attribute
            entity: sensor.flower_room_1_grow_status
            attribute: target_vpd
            name: VPD
            icon: mdi:gauge

      # Next Task
      - type: entities
        title: "üìã Next Scheduled Task"
        show_header_toggle: false
        entities:
          - entity: sensor.flower_room_1_next_task
            name: Task
          - type: attribute
            entity: sensor.flower_room_1_next_task
            attribute: task_date
            name: Date
            icon: mdi:calendar
          - type: attribute
            entity: sensor.flower_room_1_next_task
            attribute: days_until
            name: Days Until
            icon: mdi:clock-outline
          - type: attribute
            entity: sensor.flower_room_1_next_task
            attribute: priority
            name: Priority
            icon: mdi:alert-circle

      # Journal
      - type: vertical-stack
        title: "üìù Journal"
        cards:
          - type: entity
            entity: sensor.flower_room_1_journal_entries
            name: Total Entries
          - type: markdown
            content: |
              **Last Entry:** {{ state_attr('sensor.flower_room_1_journal_entries', 'last_entry_date') or 'None' }}
              
              {{ state_attr('sensor.flower_room_1_journal_entries', 'last_entry_preview') or 'No entries yet' }}
          - type: button
            name: Add Quick Note
            icon: mdi:notebook-plus
            tap_action:
              action: call-service
              service: grow_room_manager.add_journal_entry
              service_data:
                room_id: f1
                note: "Quick check - all good"

  # ===========================================================================
  # ROOM F2
  # ===========================================================================
  - title: F2
    path: f2
    icon: mdi:numeric-2-circle
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              # üåø Flower Room 2
              {% set s = 'sensor.flower_room_2_grow_status' %}
              {% set status = states(s) %}
              {% set phase = state_attr(s, 'phase') %}
              {% set week = state_attr(s, 'current_week') %}
              
              {% if status != 'Not Started' and status != 'unknown' %}
              ## {{ status }} | Week {{ week }} | {{ phase }} Phase
              {% else %}
              ## ‚è≥ Not Started
              {% endif %}

          - type: gauge
            entity: sensor.flower_room_2_grow_progress
            name: Cycle Progress
            min: 0
            max: 100

      - type: entities
        title: "üéØ Current Targets"
        entities:
          - type: attribute
            entity: sensor.flower_room_2_grow_status
            attribute: recommended_ec
            name: Target EC
          - type: attribute
            entity: sensor.flower_room_2_grow_status
            attribute: target_dryback
            name: Target Dryback
          - type: attribute
            entity: sensor.flower_room_2_grow_status
            attribute: days_remaining
            name: Days to Harvest

      - type: entities
        title: "üìã Next Task"
        entities:
          - entity: sensor.flower_room_2_next_task
            name: Task
          - type: attribute
            entity: sensor.flower_room_2_next_task
            attribute: days_until
            name: Days Until

      - type: entity
        entity: sensor.flower_room_2_journal_entries
        name: Journal Entries

  # ===========================================================================
  # ROOM F3
  # ===========================================================================
  - title: F3
    path: f3
    icon: mdi:numeric-3-circle
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              # üåø Flower Room 3
              {% set s = 'sensor.flower_room_3_grow_status' %}
              {% set status = states(s) %}
              {% set phase = state_attr(s, 'phase') %}
              {% set week = state_attr(s, 'current_week') %}
              
              {% if status != 'Not Started' and status != 'unknown' %}
              ## {{ status }} | Week {{ week }} | {{ phase }} Phase
              {% else %}
              ## ‚è≥ Not Started
              {% endif %}

          - type: gauge
            entity: sensor.flower_room_3_grow_progress
            name: Cycle Progress
            min: 0
            max: 100

      - type: entities
        title: "üéØ Current Targets"
        entities:
          - type: attribute
            entity: sensor.flower_room_3_grow_status
            attribute: recommended_ec
            name: Target EC
          - type: attribute
            entity: sensor.flower_room_3_grow_status
            attribute: target_dryback
            name: Target Dryback
          - type: attribute
            entity: sensor.flower_room_3_grow_status
            attribute: days_remaining
            name: Days to Harvest

      - type: entities
        title: "üìã Next Task"
        entities:
          - entity: sensor.flower_room_3_next_task
            name: Task
          - type: attribute
            entity: sensor.flower_room_3_next_task
            attribute: days_until
            name: Days Until

      - type: entity
        entity: sensor.flower_room_3_journal_entries
        name: Journal Entries

  # ===========================================================================
  # CALENDAR
  # ===========================================================================
  - title: Calendar
    path: calendar
    icon: mdi:calendar
    cards:
      - type: calendar
        entities:
          - calendar.grow_calendar
        initial_view: listWeek

      - type: markdown
        content: |
          **Tip:** If you don't see events, make sure you selected a calendar when adding the room.
          
          To regenerate tasks, use the **Settings** tab.

  # ===========================================================================
  # SETTINGS
  # ===========================================================================
  - title: Settings
    path: settings
    icon: mdi:cog
    cards:
      - type: markdown
        content: |
          # ‚öôÔ∏è Settings
          
          ## How to Configure Rooms
          
          1. Go to **Settings** ‚Üí **Devices & Services**
          2. Find **Grow Room Manager**
          3. Click **Configure** on any room to change:
             - Start Date
             - Calendar Entity
             - Todo List Entity
          
          ---

      # Room F1 Settings
      - type: vertical-stack
        title: "üè† Room F1"
        cards:
          - type: markdown
            content: |
              {% set s = 'sensor.flower_room_1_grow_status' %}
              **Status:** {{ states(s) }}
              **Start Date:** {{ state_attr(s, 'start_date') or 'Not set' }}
              **Phase:** {{ state_attr(s, 'phase') }}
          - type: horizontal-stack
            cards:
              - type: button
                name: Set Start Today
                icon: mdi:calendar-today
                tap_action:
                  action: call-service
                  service: grow_room_manager.set_start_date
                  service_data:
                    room_id: f1
                    start_date: "{{ now().strftime('%Y-%m-%d') }}"
                  confirmation:
                    text: Set F1 start date to today?
              - type: button
                name: Generate Tasks
                icon: mdi:calendar-plus
                tap_action:
                  action: call-service
                  service: grow_room_manager.generate_tasks
                  service_data:
                    room_id: f1
                    start_date: "{{ state_attr('sensor.flower_room_1_grow_status', 'start_date') }}"
                    calendar_entity: calendar.grow_calendar
                    todo_entity: todo.f1_tasks
                  confirmation:
                    text: Generate 35 tasks for F1?

      # Room F2 Settings
      - type: vertical-stack
        title: "üè† Room F2"
        cards:
          - type: markdown
            content: |
              {% set s = 'sensor.flower_room_2_grow_status' %}
              **Status:** {{ states(s) }}
              **Start Date:** {{ state_attr(s, 'start_date') or 'Not set' }}
              **Phase:** {{ state_attr(s, 'phase') }}
          - type: horizontal-stack
            cards:
              - type: button
                name: Set Start Today
                icon: mdi:calendar-today
                tap_action:
                  action: call-service
                  service: grow_room_manager.set_start_date
                  service_data:
                    room_id: f2
                    start_date: "{{ now().strftime('%Y-%m-%d') }}"
                  confirmation:
                    text: Set F2 start date to today?
              - type: button
                name: Generate Tasks
                icon: mdi:calendar-plus
                tap_action:
                  action: call-service
                  service: grow_room_manager.generate_tasks
                  service_data:
                    room_id: f2
                    start_date: "{{ state_attr('sensor.flower_room_2_grow_status', 'start_date') }}"
                    calendar_entity: calendar.grow_calendar
                    todo_entity: todo.f2_tasks
                  confirmation:
                    text: Generate 35 tasks for F2?

      # Room F3 Settings
      - type: vertical-stack
        title: "üè† Room F3"
        cards:
          - type: markdown
            content: |
              {% set s = 'sensor.flower_room_3_grow_status' %}
              **Status:** {{ states(s) }}
              **Start Date:** {{ state_attr(s, 'start_date') or 'Not set' }}
              **Phase:** {{ state_attr(s, 'phase') }}
          - type: horizontal-stack
            cards:
              - type: button
                name: Set Start Today
                icon: mdi:calendar-today
                tap_action:
                  action: call-service
                  service: grow_room_manager.set_start_date
                  service_data:
                    room_id: f3
                    start_date: "{{ now().strftime('%Y-%m-%d') }}"
                  confirmation:
                    text: Set F3 start date to today?
              - type: button
                name: Generate Tasks
                icon: mdi:calendar-plus
                tap_action:
                  action: call-service
                  service: grow_room_manager.generate_tasks
                  service_data:
                    room_id: f3
                    start_date: "{{ state_attr('sensor.flower_room_3_grow_status', 'start_date') }}"
                    calendar_entity: calendar.grow_calendar
                    todo_entity: todo.f3_tasks
                  confirmation:
                    text: Generate 35 tasks for F3?

      # Export
      - type: vertical-stack
        title: "üì§ Export Journals"
        cards:
          - type: horizontal-stack
            cards:
              - type: button
                name: Export F1 CSV
                icon: mdi:file-export
                tap_action:
                  action: call-service
                  service: grow_room_manager.export_journal
                  service_data:
                    room_id: f1
                    format: csv
              - type: button
                name: Export F2 CSV
                icon: mdi:file-export
                tap_action:
                  action: call-service
                  service: grow_room_manager.export_journal
                  service_data:
                    room_id: f2
                    format: csv
              - type: button
                name: Export F3 CSV
                icon: mdi:file-export
                tap_action:
                  action: call-service
                  service: grow_room_manager.export_journal
                  service_data:
                    room_id: f3
                    format: csv

  # ===========================================================================
  # FEEDING CALCULATOR
  # ===========================================================================
  - title: Feeding
    path: feeding
    icon: mdi:beaker
    cards:
      - type: markdown
        content: |
          # üß™ Athena Feeding Calculator
          
          Select a room to see the current feeding recipe:

      # F1 Feeding
      - type: vertical-stack
        title: "üè† F1 Feeding"
        cards:
          - type: markdown
            content: |
              {% set s = 'sensor.flower_room_1_grow_status' %}
              {% set phase = state_attr(s, 'phase') %}
              {% set ec = state_attr(s, 'recommended_ec') %}
              {% set day = state_attr(s, 'current_day') %}
              
              {% if phase and phase != 'Not Started' %}
              **Phase:** {{ phase }} | **Day {{ day }}** | **Target EC:** {{ ec }}
              
              {% if phase == 'Stretch' or phase == 'Bulk' %}
              ### Core + Bloom Recipe (EC 3.0)
              | Tank | Core | Bloom |
              |------|------|-------|
              | 20L | 16g | 16g |
              | 50L | 40g | 40g |
              | 100L | 79g | 79g |
              | 200L | 158g | 158g |
              {% else %}
              ### Fade Recipe (EC 1.5)
              | Tank | Fade | Cleanse |
              |------|------|---------|
              | 20L | 16g | 5g |
              | 50L | 40g | 13g |
              | 100L | 79g | 26g |
              | 200L | 158g | 52g |
              {% endif %}
              {% else %}
              ‚è≥ Set start date to see recipe
              {% endif %}

      # F2 Feeding
      - type: vertical-stack
        title: "üè† F2 Feeding"
        cards:
          - type: markdown
            content: |
              {% set s = 'sensor.flower_room_2_grow_status' %}
              {% set phase = state_attr(s, 'phase') %}
              {% set ec = state_attr(s, 'recommended_ec') %}
              {% set day = state_attr(s, 'current_day') %}
              
              {% if phase and phase != 'Not Started' %}
              **Phase:** {{ phase }} | **Day {{ day }}** | **Target EC:** {{ ec }}
              
              {% if phase == 'Stretch' or phase == 'Bulk' %}
              ### Core + Bloom Recipe (EC 3.0)
              | Tank | Core | Bloom |
              |------|------|-------|
              | 20L | 16g | 16g |
              | 50L | 40g | 40g |
              | 100L | 79g | 79g |
              | 200L | 158g | 158g |
              {% else %}
              ### Fade Recipe (EC 1.5)
              | Tank | Fade | Cleanse |
              |------|------|---------|
              | 20L | 16g | 5g |
              | 50L | 40g | 13g |
              | 100L | 79g | 26g |
              | 200L | 158g | 52g |
              {% endif %}
              {% else %}
              ‚è≥ Set start date to see recipe
              {% endif %}

      # F3 Feeding
      - type: vertical-stack
        title: "üè† F3 Feeding"
        cards:
          - type: markdown
            content: |
              {% set s = 'sensor.flower_room_3_grow_status' %}
              {% set phase = state_attr(s, 'phase') %}
              {% set ec = state_attr(s, 'recommended_ec') %}
              {% set day = state_attr(s, 'current_day') %}
              
              {% if phase and phase != 'Not Started' %}
              **Phase:** {{ phase }} | **Day {{ day }}** | **Target EC:** {{ ec }}
              
              {% if phase == 'Stretch' or phase == 'Bulk' %}
              ### Core + Bloom Recipe (EC 3.0)
              | Tank | Core | Bloom |
              |------|------|-------|
              | 20L | 16g | 16g |
              | 50L | 40g | 40g |
              | 100L | 79g | 79g |
              | 200L | 158g | 158g |
              {% else %}
              ### Fade Recipe (EC 1.5)
              | Tank | Fade | Cleanse |
              |------|------|---------|
              | 20L | 16g | 5g |
              | 50L | 40g | 13g |
              | 100L | 79g | 26g |
              | 200L | 158g | 52g |
              {% endif %}
              {% else %}
              ‚è≥ Set start date to see recipe
              {% endif %}

      # Mixing Instructions
      - type: markdown
        title: "üìã Mixing Instructions"
        content: |
          1. Fill tank with RO/filtered water
          2. Add **Core** first, stir well
          3. Add **Bloom** (or Fade), stir well
          4. Check EC - adjust if needed
          5. Adjust pH to **5.8-6.0**
          6. Let mix 15 min before use
          
          ---
          
          **‚ö†Ô∏è Never mix concentrates directly!**
          
          **üí° Tip:** Check source water EC first

  # ===========================================================================
  # GUIDE
  # ===========================================================================
  - title: Guide
    path: guide
    icon: mdi:book-open-variant
    cards:
      - type: markdown
        content: |
          # üìñ Athena Pro Line Guide
          
          ## Phase Overview
          
          | Phase | Days | EC | Dryback | Key Actions |
          |-------|------|-----|---------|-------------|
          | **Stretch** | 1-21 | 3.0 | 20-25% | Defoliation, IPM |
          | **Bulk** | 22-55 | 3.0 | 30-40% | Maintenance q3d |
          | **Finish** | 56-84 | 1.5 | 40-50% | Fade, harvest |
          
          ---
          
          ## Critical Days
          
          | Day | Action |
          |-----|--------|
          | 2 | Heavy defoliation (strip lower 1/3) |
          | 21 | Final defoliation + LAST IPM spray |
          | 42 | Major maintenance prune |
          | 56 | Switch to Athena Fade (0 nitrogen) |
          | 77-84 | Harvest window |
          
          ---
          
          ## Environmental Targets
          
          ### Stretch (Days 1-21)
          - Day: 78-82¬∞F (25-28¬∞C)
          - Night: 68-72¬∞F (20-22¬∞C)
          - Humidity: 55-65%
          - VPD: 1.0-1.2 kPa
          
          ### Bulk (Days 22-55)
          - Day: 78-82¬∞F (25-28¬∞C)
          - Night: 65-70¬∞F (18-21¬∞C)
          - Humidity: 50-60%
          - VPD: 1.2-1.4 kPa
          
          ### Finish (Days 56-84)
          - Day: 75-78¬∞F (24-26¬∞C)
          - Night: 62-68¬∞F (17-20¬∞C)
          - Humidity: 40-50%
          - VPD: 1.4-1.6 kPa
          
          ---
          
          ## IPM Schedule (Days 1-21 only)
          
          Apply 2x per week: Days 3, 7, 10, 14, 17, 21
          
          ‚ö†Ô∏è **NO SPRAYS AFTER DAY 21!**
          
          ---
          
          ## Nutrient Mix (per 100gal)
          
          **Stretch/Bulk (EC 3.0):**
          - Athena Core: 300g
          - Athena Bloom: 300g
          - pH: 5.8-6.0
          
          **Finish (EC 1.5):**
          - Athena Fade: per label
          - pH: 5.8-6.0
