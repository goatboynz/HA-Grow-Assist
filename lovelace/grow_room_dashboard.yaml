# =============================================================================
# GROW ROOM MANAGER - Complete Dashboard
# =============================================================================
# 
# HOW TO USE:
# 1. Add rooms via: Settings > Devices & Services > Add Integration > Grow Room Manager
# 2. Set start date and optionally select calendar/todo entities
# 3. Tasks are auto-generated when you add a room!
# 4. Copy this dashboard or individual cards from lovelace/cards/
#
# =============================================================================

title: Grow Rooms
views:
  # ===========================================================================
  # OVERVIEW
  # ===========================================================================
  - title: "Overview"
    path: overview
    icon: mdi:view-dashboard
    cards:
      - type: markdown
        content: |
          # ðŸŒ¿ Grow Room Manager
          
          Add rooms via **Settings â†’ Devices & Services â†’ Grow Room Manager**
          
          Tasks are automatically generated when you set a start date!

      - type: horizontal-stack
        cards:
          - type: entity
            entity: sensor.flower_room_1_grow_status
            name: "F1"
            icon: mdi:numeric-1-circle
          - type: entity
            entity: sensor.flower_room_2_grow_status
            name: "F2"
            icon: mdi:numeric-2-circle
          - type: entity
            entity: sensor.flower_room_3_grow_status
            name: "F3"
            icon: mdi:numeric-3-circle

      - type: horizontal-stack
        cards:
          - type: gauge
            entity: sensor.flower_room_1_grow_progress
            name: "F1"
            min: 0
            max: 100
          - type: gauge
            entity: sensor.flower_room_2_grow_progress
            name: "F2"
            min: 0
            max: 100
          - type: gauge
            entity: sensor.flower_room_3_grow_progress
            name: "F3"
            min: 0
            max: 100

      - type: entities
        title: "ðŸ“‹ Upcoming Tasks"
        entities:
          - entity: sensor.flower_room_1_next_task
            name: "F1 Next"
          - entity: sensor.flower_room_2_next_task
            name: "F2 Next"
          - entity: sensor.flower_room_3_next_task
            name: "F3 Next"

  # ===========================================================================
  # ROOM F1
  # ===========================================================================
  - title: "F1"
    path: f1
    icon: mdi:numeric-1-circle
    cards:
      - type: markdown
        content: |
          # ðŸŒ¿ Flower Room 1
          {% set status = states('sensor.flower_room_1_grow_status') %}
          {% set phase = state_attr('sensor.flower_room_1_grow_status', 'phase') %}
          {% set week = state_attr('sensor.flower_room_1_grow_status', 'current_week') %}
          {% set ec = state_attr('sensor.flower_room_1_grow_status', 'recommended_ec') %}
          {% set dryback = state_attr('sensor.flower_room_1_grow_status', 'target_dryback') %}
          {% set remaining = state_attr('sensor.flower_room_1_grow_status', 'days_remaining') %}
          {% set harvest = state_attr('sensor.flower_room_1_grow_status', 'harvest_window') %}
          
          {% if status != 'Not Started' %}
          ## {{ status }} | Week {{ week }} | {{ phase }}
          {% if harvest %}ðŸŽ‰ **HARVEST WINDOW OPEN!** ðŸŽ‰{% endif %}
          
          | Target | Value |
          |--------|-------|
          | EC | {{ ec }} |
          | Dryback | {{ dryback }} |
          | Days to Harvest | {{ remaining }} |
          {% else %}
          ## Not Started
          Add a start date via Settings > Devices & Services > Grow Room Manager > Configure
          {% endif %}

      - type: gauge
        entity: sensor.flower_room_1_grow_progress
        name: "Progress"
        min: 0
        max: 100

      - type: entities
        title: "ðŸŽ¯ Environmental Targets"
        entities:
          - type: attribute
            entity: sensor.flower_room_1_grow_status
            attribute: target_temp_day
            name: "Day Temp"
          - type: attribute
            entity: sensor.flower_room_1_grow_status
            attribute: target_temp_night
            name: "Night Temp"
          - type: attribute
            entity: sensor.flower_room_1_grow_status
            attribute: target_humidity
            name: "Humidity"
          - type: attribute
            entity: sensor.flower_room_1_grow_status
            attribute: target_vpd
            name: "VPD"

      - type: entities
        title: "ðŸ“‹ Next Task"
        entities:
          - entity: sensor.flower_room_1_next_task
            name: "Task"
          - type: attribute
            entity: sensor.flower_room_1_next_task
            attribute: days_until
            name: "Days Until"
          - type: attribute
            entity: sensor.flower_room_1_next_task
            attribute: priority
            name: "Priority"

      - type: entity
        entity: sensor.flower_room_1_journal_entries
        name: "Journal Entries"

      - type: button
        name: "Add Journal Note"
        icon: mdi:notebook-plus
        tap_action:
          action: call-service
          service: grow_room_manager.add_journal_entry
          service_data:
            room_id: "f1"
            note: "Quick check completed"

  # ===========================================================================
  # ROOM F2
  # ===========================================================================
  - title: "F2"
    path: f2
    icon: mdi:numeric-2-circle
    cards:
      - type: markdown
        content: |
          # ðŸŒ¿ Flower Room 2
          {% set status = states('sensor.flower_room_2_grow_status') %}
          {% set phase = state_attr('sensor.flower_room_2_grow_status', 'phase') %}
          {% set week = state_attr('sensor.flower_room_2_grow_status', 'current_week') %}
          {% set ec = state_attr('sensor.flower_room_2_grow_status', 'recommended_ec') %}
          {% set dryback = state_attr('sensor.flower_room_2_grow_status', 'target_dryback') %}
          
          {% if status != 'Not Started' %}
          ## {{ status }} | Week {{ week }} | {{ phase }}
          
          | Target | Value |
          |--------|-------|
          | EC | {{ ec }} |
          | Dryback | {{ dryback }} |
          {% else %}
          ## Not Started
          {% endif %}

      - type: gauge
        entity: sensor.flower_room_2_grow_progress
        name: "Progress"
        min: 0
        max: 100

      - type: entities
        title: "ðŸ“‹ Next Task"
        entities:
          - entity: sensor.flower_room_2_next_task
            name: "Task"
          - type: attribute
            entity: sensor.flower_room_2_next_task
            attribute: days_until
            name: "Days Until"

      - type: entity
        entity: sensor.flower_room_2_journal_entries
        name: "Journal Entries"

  # ===========================================================================
  # ROOM F3
  # ===========================================================================
  - title: "F3"
    path: f3
    icon: mdi:numeric-3-circle
    cards:
      - type: markdown
        content: |
          # ðŸŒ¿ Flower Room 3
          {% set status = states('sensor.flower_room_3_grow_status') %}
          {% set phase = state_attr('sensor.flower_room_3_grow_status', 'phase') %}
          {% set week = state_attr('sensor.flower_room_3_grow_status', 'current_week') %}
          {% set ec = state_attr('sensor.flower_room_3_grow_status', 'recommended_ec') %}
          {% set dryback = state_attr('sensor.flower_room_3_grow_status', 'target_dryback') %}
          
          {% if status != 'Not Started' %}
          ## {{ status }} | Week {{ week }} | {{ phase }}
          
          | Target | Value |
          |--------|-------|
          | EC | {{ ec }} |
          | Dryback | {{ dryback }} |
          {% else %}
          ## Not Started
          {% endif %}

      - type: gauge
        entity: sensor.flower_room_3_grow_progress
        name: "Progress"
        min: 0
        max: 100

      - type: entities
        title: "ðŸ“‹ Next Task"
        entities:
          - entity: sensor.flower_room_3_next_task
            name: "Task"
          - type: attribute
            entity: sensor.flower_room_3_next_task
            attribute: days_until
            name: "Days Until"

      - type: entity
        entity: sensor.flower_room_3_journal_entries
        name: "Journal Entries"

  # ===========================================================================
  # GUIDE
  # ===========================================================================
  - title: "ðŸ“– Guide"
    path: guide
    icon: mdi:book-open-variant
    cards:
      - type: markdown
        content: |
          # Athena Pro Line Quick Reference
          
          ## Phases
          | Phase | Days | EC | Dryback |
          |-------|------|-----|---------|
          | Stretch | 1-21 | 3.0 | 20-25% |
          | Bulk | 22-55 | 3.0 | 30-40% |
          | Finish | 56-84 | 1.5 | 40-50% |
          
          ## Critical Days
          - **Day 2**: Heavy defoliation
          - **Day 21**: Final defoliation + LAST IPM
          - **Day 42**: Major maintenance prune
          - **Day 56**: Switch to Athena Fade
          - **Day 77-84**: Harvest window
          
          ## Environmental Targets
          
          **Stretch (1-21):** 78-82Â°F day, 68-72Â°F night, 55-65% RH, VPD 1.0-1.2
          
          **Bulk (22-55):** 78-82Â°F day, 65-70Â°F night, 50-60% RH, VPD 1.2-1.4
          
          **Finish (56-84):** 75-78Â°F day, 62-68Â°F night, 40-50% RH, VPD 1.4-1.6
