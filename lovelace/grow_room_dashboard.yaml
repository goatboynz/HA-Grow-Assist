# Grow Room Manager Dashboard
# Copy this to your Lovelace configuration or use as a separate dashboard
#
# PREREQUISITES:
# 1. Install Grow Room Manager integration via HACS
# 2. Add rooms via Settings > Devices & Services > Add Integration > Grow Room Manager
# 3. Create these helpers for each room (replace X with room number):
#    - input_datetime.fX_start_date (date only)
#    - input_text.fX_journal_note
# 4. Create a calendar entity (e.g., via Local Calendar integration)
# 5. Create todo list entities for each room (via Local To-do integration)

title: Grow Room Manager
views:
  - title: Overview
    path: overview
    icon: mdi:cannabis
    cards:
      # Room Status Cards
      - type: horizontal-stack
        cards:
          - type: entity
            entity: sensor.flower_room_1_grow_status
            name: F1 Status
            icon: mdi:flower
          - type: entity
            entity: sensor.flower_room_2_grow_status
            name: F2 Status
            icon: mdi:flower
          - type: entity
            entity: sensor.flower_room_3_grow_status
            name: F3 Status
            icon: mdi:flower

      # Quick Actions
      - type: markdown
        title: Quick Start Guide
        content: |
          ## How to Use
          1. **Set Start Date**: Enter the flip date (Day 1 of flower)
          2. **Generate Tasks**: Click to create 84 days of tasks
          3. **Track Progress**: Sensor shows current day and phase
          4. **Journal**: Add notes and photos throughout the grow
          
          ## Current Phase Targets
          | Phase | Days | EC | Dryback |
          |-------|------|-----|---------|
          | Stretch | 1-21 | 3.0 | 20-25% |
          | Bulk | 22-55 | 3.0 | 30-40% |
          | Finish | 56-84 | 1.5 | 40-50% |

  - title: F1 Room
    path: f1
    icon: mdi:numeric-1-circle
    cards:
      # Status Card
      - type: markdown
        title: F1 - Flower Room 1
        content: |
          **Status:** {{ states('sensor.flower_room_1_grow_status') }}
          **Phase:** {{ state_attr('sensor.flower_room_1_grow_status', 'phase') }}
          **Target EC:** {{ state_attr('sensor.flower_room_1_grow_status', 'recommended_ec') }}
          **Dryback:** {{ state_attr('sensor.flower_room_1_grow_status', 'target_dryback') }}
          **Days to Harvest:** {{ state_attr('sensor.flower_room_1_grow_status', 'days_remaining') }}
          {% if state_attr('sensor.flower_room_1_grow_status', 'harvest_window') %}
          ðŸŒ¿ **HARVEST WINDOW OPEN** ðŸŒ¿
          {% endif %}

      # Start Date & Task Generation
      - type: entities
        title: Cycle Management
        entities:
          - entity: input_datetime.f1_start_date
            name: Start Date (Day 1 of Flower)

      - type: horizontal-stack
        cards:
          - type: button
            name: Generate Tasks
            icon: mdi:calendar-plus
            tap_action:
              action: call-service
              service: grow_room_manager.generate_tasks
              service_data:
                room_id: f1
                start_date: "{{ states('input_datetime.f1_start_date') }}"
                calendar_entity: calendar.grow_calendar
                todo_entity: todo.grow_tasks_f1
              confirmation:
                text: Generate all 35 Athena schedule tasks for F1?

      # Todo List
      - type: todo-list
        entity: todo.grow_tasks_f1
        title: F1 Tasks

      # Journal Entry
      - type: entities
        title: Add Journal Entry
        entities:
          - entity: input_text.f1_journal_note
            name: Note

      - type: horizontal-stack
        cards:
          - type: button
            name: Save Note
            icon: mdi:content-save
            tap_action:
              action: call-service
              service: grow_room_manager.add_journal_entry
              service_data:
                room_id: f1
                note: "{{ states('input_text.f1_journal_note') }}"
          - type: button
            name: Save with Photo
            icon: mdi:camera
            tap_action:
              action: call-service
              service: grow_room_manager.add_journal_entry
              service_data:
                room_id: f1
                note: "{{ states('input_text.f1_journal_note') }}"
                image_entity: camera.grow_room_f1

  - title: F2 Room
    path: f2
    icon: mdi:numeric-2-circle
    cards:
      - type: markdown
        title: F2 - Flower Room 2
        content: |
          **Status:** {{ states('sensor.flower_room_2_grow_status') }}
          **Phase:** {{ state_attr('sensor.flower_room_2_grow_status', 'phase') }}
          **Target EC:** {{ state_attr('sensor.flower_room_2_grow_status', 'recommended_ec') }}
          **Dryback:** {{ state_attr('sensor.flower_room_2_grow_status', 'target_dryback') }}
          **Days to Harvest:** {{ state_attr('sensor.flower_room_2_grow_status', 'days_remaining') }}

      - type: entities
        title: Cycle Management
        entities:
          - entity: input_datetime.f2_start_date
            name: Start Date (Day 1 of Flower)

      - type: horizontal-stack
        cards:
          - type: button
            name: Generate Tasks
            icon: mdi:calendar-plus
            tap_action:
              action: call-service
              service: grow_room_manager.generate_tasks
              service_data:
                room_id: f2
                start_date: "{{ states('input_datetime.f2_start_date') }}"
                calendar_entity: calendar.grow_calendar
                todo_entity: todo.grow_tasks_f2
              confirmation:
                text: Generate all 35 Athena schedule tasks for F2?

      - type: todo-list
        entity: todo.grow_tasks_f2
        title: F2 Tasks

      - type: entities
        title: Add Journal Entry
        entities:
          - entity: input_text.f2_journal_note
            name: Note

      - type: horizontal-stack
        cards:
          - type: button
            name: Save Note
            icon: mdi:content-save
            tap_action:
              action: call-service
              service: grow_room_manager.add_journal_entry
              service_data:
                room_id: f2
                note: "{{ states('input_text.f2_journal_note') }}"

  - title: F3 Room
    path: f3
    icon: mdi:numeric-3-circle
    cards:
      - type: markdown
        title: F3 - Flower Room 3
        content: |
          **Status:** {{ states('sensor.flower_room_3_grow_status') }}
          **Phase:** {{ state_attr('sensor.flower_room_3_grow_status', 'phase') }}
          **Target EC:** {{ state_attr('sensor.flower_room_3_grow_status', 'recommended_ec') }}
          **Dryback:** {{ state_attr('sensor.flower_room_3_grow_status', 'target_dryback') }}
          **Days to Harvest:** {{ state_attr('sensor.flower_room_3_grow_status', 'days_remaining') }}

      - type: entities
        title: Cycle Management
        entities:
          - entity: input_datetime.f3_start_date
            name: Start Date (Day 1 of Flower)

      - type: horizontal-stack
        cards:
          - type: button
            name: Generate Tasks
            icon: mdi:calendar-plus
            tap_action:
              action: call-service
              service: grow_room_manager.generate_tasks
              service_data:
                room_id: f3
                start_date: "{{ states('input_datetime.f3_start_date') }}"
                calendar_entity: calendar.grow_calendar
                todo_entity: todo.grow_tasks_f3
              confirmation:
                text: Generate all 35 Athena schedule tasks for F3?

      - type: todo-list
        entity: todo.grow_tasks_f3
        title: F3 Tasks

      - type: entities
        title: Add Journal Entry
        entities:
          - entity: input_text.f3_journal_note
            name: Note

      - type: horizontal-stack
        cards:
          - type: button
            name: Save Note
            icon: mdi:content-save
            tap_action:
              action: call-service
              service: grow_room_manager.add_journal_entry
              service_data:
                room_id: f3
                note: "{{ states('input_text.f3_journal_note') }}"

  - title: Calendar
    path: calendar
    icon: mdi:calendar
    cards:
      - type: calendar
        entities:
          - calendar.grow_calendar
        initial_view: listWeek
